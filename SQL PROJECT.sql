CREATE DATABASE LIBRARY;
USE LIBRARY;
CREATE TABLE BRANCH(BRANCH_NO INT PRIMARY KEY ,MANAGER_ID INT,BRANCH_ADDRESS VARCHAR(30) ,CONTACT_NO INT);
INSERT INTO BRANCH VALUES (1,101,'kayamkulam',10120);
INSERT INTO BRANCH VALUES (2,102,'kollam',101120);
INSERT INTO BRANCH VALUES (3,103,'kottiyam',100120);
INSERT INTO BRANCH VALUES (4,104,'alappuzha',101220);
INSERT INTO BRANCH VALUES (5,105,'kannnur',101320);
INSERT INTO BRANCH VALUES (6,106,'kayamkulam',101220);

SELECT * FROM BRANCH;

CREATE TABLE EMPLOYEE(EMP_ID INT PRIMARY KEY,EMP_NAME VARCHAR(50),POSITION VARCHAR (50),SALARY DECIMAL);
INSERT INTO EMPLOYEE VALUES (106,'arunima','manager',25000.00);
INSERT INTO EMPLOYEE VALUES (107,'alfas','director',24000.00);
INSERT INTO EMPLOYEE VALUES (108,'sneha','director',24000.00);
INSERT INTO EMPLOYEE VALUES (109,'jaleel','clerk',24000.00);
INSERT INTO EMPLOYEE VALUES (110,'lekha','clerk',15000.00);
INSERT INTO EMPLOYEE VALUES (111,'shyna','peon',5000.00);
SELECT * FROM EMPLOYEE;


CREATE TABLE CUSTOMER (CUSTOMER_ID INT,CUSTOMER_NAME VARCHAR(30),CUSTOMER_ADDRESS VARCHAR(50),REG_DATE DATE);
INSERT INTO CUSTOMER VALUES(1,'liju','liju villa','2021-3-13');
INSERT INTO CUSTOMER VALUES(2,'lijina','lijina manzil','2022-3-13');
INSERT INTO CUSTOMER VALUES(3,'kavya','kavya villa','2020-4-23');
INSERT INTO CUSTOMER VALUES(4,'mohan','mohan villa','2019-5-3');
INSERT INTO CUSTOMER VALUES(5,'krishnan','krishnan villa','2021-3-23');
INSERT INTO CUSTOMER VALUES(6,'rani','rani villa','2022-3-10');
INSERT INTO CUSTOMER VALUES(7,'rani','rani villa','2019-3-10');

SELECT * FROM CUSTOMER;

CREATE TABLE ISSUESTATUS(ISSUE_ID INT PRIMARY KEY,ISSUED_CUST INT,ISSUED_BOOK_NAME VARCHAR(80),
ISSUE_DATE DATE,ISBN_BOOK INT (80),
FOREIGN KEY (ISSUED_CUST)REFERENCES CUSTOMER(CUSTOMER_ID)
 ,FOREIGN KEY (ISBN_BOOK) REFERENCES BOOKS(ISBN));
 INSERT INTO ISSUESTATUS VALUES (1,2,'my india','2019-2-13',1234);
 INSERT INTO ISSUESTATUS VALUES (2,1,'aarachar','2020-12-10',12134);
 INSERT INTO ISSUESTATUS VALUES (3,4,'half girlfriend','2021-3-3',12234);
 INSERT INTO ISSUESTATUS VALUES (4,5,'kabar','2020-4-23',12334);
 INSERT INTO ISSUESTATUS(ISSUE_ID,ISSUED_CUST,ISSUED_BOOK_NAME) VALUES (5,3,NULL);
  INSERT INTO ISSUESTATUS(ISSUE_ID,ISSUED_CUST,ISSUED_BOOK_NAME) VALUES (6,7,NULL);
 
 SELECT * FROM ISSUESTATUS;
 
CREATE INDEX inx_issuestatus ON CUSTOMER(CUSTOMER_ID);
CREATE INDEX inx_isbnbook ON BOOKS(ISBN);
 
CREATE TABLE RETURNSTATUS(RETURN_ID INT,RETURN_CUST INT ,RETURN_BOOK_NAME VARCHAR(100),
RETURN_DATE DATE ,ISBN_BOOK2 INT,FOREIGN KEY (ISBN_BOOK2) REFERENCES BOOKS(ISBN));

INSERT RETURNSTATUS VALUES(1,3,'half girlfriend','2022-4-13',12234);
INSERT RETURNSTATUS VALUES(2,1,'wings of fire','2023-4-13',12342);
INSERT RETURNSTATUS VALUES(3,2,'kabar','2021-4-1',12334);
INSERT RETURNSTATUS VALUES(4,5,'my india','2021-4-10',1234);
INSERT RETURNSTATUS VALUES(5,4,'aarachar ','2022-4-21',12134);

SELECT * FROM RETURNSTATUS;

CREATE TABLE BOOKS (ISBN INT PRIMARY KEY,BOOK_TITLE VARCHAR(80),CATEGORY VARCHAR (30),
RENTAL_PRICE DECIMAL,STATUS VARCHAR (5),AUTHOR VARCHAR (30),PUBLISHER VARCHAR (50));
INSERT INTO BOOKS VALUES(1234,'title 1','science',250.0,'yes','abdul kalam','publisher 1');
INSERT INTO BOOKS VALUES(12134,'title 2','novel',160.0,'yes','k.r meera','publisher 2');
INSERT INTO BOOKS VALUES(12234,'title 3','novel',180.0,'no','chethan bhagath','publisher 3');
INSERT INTO BOOKS VALUES(12334,'title 4','story',200.0,'yes','k.r meera','publisher 2');
INSERT INTO BOOKS VALUES(12342,'title 5','biography',250.0,'no','abdul kalam','publisher 1');
SELECT * FROM BOOKS;

-- 1.Retrieve the book title, category, and rental price of all available books.
SELECT BOOK_TITLE, CATEGORY, RENTAL_PRICE FROM BOOKS WHERE STATUS='yes';

-- 2.List the employee names and their respective salaries in descending order of salary. 
SELECT EMP_NAME,SALARY FROM EMPLOYEE ORDER BY SALARY DESC; 

-- 3.. Retrieve the book titles and the corresponding customers who have issued those books.
SELECT BOOK_TITLE,CUSTOMER_NAME FROM ISSUESTATUS INNER JOIN BOOKS ON BOOKS.ISBN=ISSUESTATUS.ISBN_BOOK
  INNER JOIN CUSTOMER ON CUSTOMER.CUSTOMER_ID=ISSUESTATUS.ISSUED_CUST;


-- 4. Display the total count of books in each category.
SELECT CATEGORY, COUNT(*) FROM BOOKS GROUP BY CATEGORY;

-- 5.. Retrieve the employee names and their positions for the employees whose salaries are above Rs.20,000;
SELECT EMP_NAME,POSITION,SALARY FROM EMPLOYEE WHERE SALARY > 20000.00;

-- 6.List the customer names who registered before 2022-01-01 and have not issued any books yet
SELECT CUSTOMER_NAME,REG_DATE FROM CUSTOMER INNER  JOIN ISSUESTATUS ON CUSTOMER.CUSTOMER_ID=ISSUESTATUS.ISSUED_CUST 
WHERE REG_DATE<'2022-01-01' AND  ISSUE_DATE=NULL ;

-- 7. Display the branch numbers and the total count of employees in each branch.
SELECT BRANCH_NO,count(*) AS total_count FROM BRANCH INNER JOIN EMPLOYEE ON BRANCH.MANAGER_ID=EMPLOYEE.EMP_ID GROUP BY BRANCH_NO;

-- 8. Display the names of customers who have issued books in the month of DECEMBER 2020
SELECT CUSTOMER_NAME FROM CUSTOMER INNER JOIN ISSUESTATUS ON 
CUSTOMER.CUSTOMER_ID=ISSUESTATUS.ISSUED_CUST WHERE EXTRACT(YEAR_MONTH FROM ISSUE_DATE)='202012';

-- 9.9. Retrieve book_title from book table containing novel.
SELECT BOOK_TITLE FROM BOOKS WHERE CATEGORY='NOVEL';

-- 10.Retrieve the branch numbers along with the count of employees for branches having more than 5 employees.

SELECT Branch_no, COUNT(*) AS Total_Count
FROM BRANCH
JOIN EMPLOYEE  ON BRANCH .MANAGER_ID= EMPLOYEE.EMP_ID
GROUP BY Branch_no
HAVING Total_Count > 5;





